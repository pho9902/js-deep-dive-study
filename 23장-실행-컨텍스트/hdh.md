# 23장 실행-컨텍스트

### 1. 소스코드의 타입

- ECMAScript 사양은 소스코드를 4가지 타입으로 구분한다.
- 이 4가지 타입의 소스코드는 실행 컨텍스트를 생성한다.

1. 전역 코드
   - 전역 코드는 최상위 스코프인 전역 스코프를 생성해야 한다.
   - 전역 변수와 전역 함수를 전역 객체의 프로퍼티와 메서드에 연결해야 한다.
   - 이를 위해 전역 코드가 평가되면 전역 실행 컨텍스트가 생성된다.
2. 함수 코드
   - 함수 코드는 지역 스코프를 생성해야 한다.
   - 지역 변수, 매개변수, arguments 객체를 관리해야 한다.
   - 지역 스코프를 전역 스코프부터 시작하는 스코프 체인의 일원으로 연결해야 한다.
   - 이를 위해 함수 코드가 평가되면 함수 실행 컨텍스트가 생성된다.
3. eval 코드
   - strict mode에서 eval코드는 자신만의 독자적인 스코프를 생성한다.
   - 이를 위해 eval 코드가 평가되면 eval 실행 컨텍스트가 생성된다.
4. 모듈 코드
   - 모듈 코드는 모듈별로 독립적인 스코프를 생성한다.
   - 이를 위해 모듈 코드가 평가되면 모듈 실행 컨텍스트가 생성된다.

### 2. 소스코드의 평가와 실행

- 자바스크립트는 소스코드를 평가와 실행 2개의 과정으로 나누어 처리한다.
- 소스코드 평가 과정에서 실행 컨텍스트를 생성하고 변수, 함수의 선언문만 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록한다.
- 소스코드 실행 과정에서 실행 컨텍스트가 관리하는 스코프에서 소스코드 실행에 필요한 정보를 검색해서 취득한다.

### 3. 실행 컨텍스트의 역할

> 실행 컨텍스트는 식별자를 등록하고 스코프와 코드 실행 순서 관리를 구현한 메커니즘

1. 전역 코드 평가
   - 선언문만 먼저 실행 후 전역 스코프에 등록
2. 전역 코드 실행
   - 전역 변수에 값 할당
   - 함수 호출(함수 호출 시 전역 코드 실행을 중단하고 함수 내부로 진입)
3. 함수 코드 평가
   - 매개변수, 지역변수 선언문 실행 후 지역 스코프에 등록
   - arguments 객체 생성, this 바인딩 결정
4. 함수 코드 실행
   - 매개변수와 지역 변수에 값 할당
   - 함수 호출이 종료되면 이전 실행하던 코드로 돌아감

### 4. 실행 컨텍스트 스택

- 실행 컨텍스트 스택은 코드의 실행 순서를 관리한다.
- 실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 현재 실행 중인 코드의 실행 컨텍스트다.

```js
const x = 1;

function foo() {
  const y = 2;

  function bar() {
    const z = 3;
    console.log(x + y + z);
  }
  bar();
}

foo(); // 6
```

1. 전역 코드의 평가와 실행
2. foo 함수 코드의 평가와 실행
3. bar 함수 코드의 평가와 실행
4. foo 함수 코드로 복귀
5. 전역 코드로 복귀

### 5. 렉시컬 환경

- 식별자에 바인딩된 값, 상위 스코프에 대한 참조를 기록하는 자료구조이다.
- 즉, 렉시컬 환경은 스코프와 식별자를 관리한다.
- **환경 레코드**와 **외부 렉시컬 환경에 대한 참조**로 구성된다.
  - `환경 레코드`: 스코프에 포함된 식별자를 등록하고 식별자에 바인딩된 값을 관리하는 저장한다.
  - `외부 렉시컬 환경에 대한 참조`: 상위 스코프를 가리킨다.. 즉, 해당 렉시컬 환경을 포함하는 상위 코드의 렉시컬 환경을 말한다.
