# 17장 생성자-함수에-의한-객체-생성

## Object 생성자 함수

&nbsp;new 연산자와 함께 Object 생성자 함수를 호출하면 빈 객체를 생성하여 반환한다.

- 생성자 함수: new 연산자와 함께 호출하여 객체(인스턴스)를 생성하는 함수
- 인스턴스: 생성자 함수에 의해 생성된 객체

## 생성자 함수

### 객체 리터널에 의한 객체 생성 방식의 문제점

&nbsp;객체 리터널에 의한 객체 생성 방식은 단 하나의 객체만 생성한다. 때문에 동일한 프로퍼티를 갖는 여러 객체를 여러 개 생성해야 할 때는 비효율적이다.

### 생성자 함수에 의한 객체 생성 방식의 장점

&nbsp;프로퍼티 구조가 동일한 객체 여러 개를 간편하게 생성할 수 있다.

```js
function Circle(radius) {
  this.radius = radius;
  this.getDiameter = () => {
    return this.radius * 2;
  };
}

const circle1 = new Circle(5);
const circle2 = new Circle(10);

console.log(circle1.getDiameter()); //10
console.log(circle2.getDiameter()); //20
```

> ### this
>
> this 바인딩은 함수 호출방싱에 따라 동적으로 결정된다.
> |함수 호출 방식| this가 가르키는 값(this 바인딩)|
> |---|---|
> |일반 함수로서 호출| 전역 객체|
> |메서드로서 호출| 메서드를 호출한 객체|
> |생성자 함수로서 호출| 생성자 함수가 생성할 인스턴스|

&nbsp;일반 함수와 동일한 방법으로 생성자 함수를 정의하고 new 연산자와 함께 호출하면 해당 함수는 생성자 함수로 동작한다. new 연산자 없이 호출하면 일반 함수로 동작한다.

### 생성자 함수의 인스턴스 생성 과정

&nbsp;먼저 템플릿으로서 동작하여 인스턴스를 생성하고 생성된 인스턴스를 초기화한다. 인스턴스를 생성하는 것은 필수이고, 생성된 인스턴스를 초기화 하는 것은 옵션이다. 이 모든 과정 후 자바스크립트 엔진은 암묵적인 처리를 통해 인스턴스를 생성하고 반환한다.

#### 1.인스턴스 생성과 this 바인딩

&nbsp;암묵적으로 빈 객체가 생성되고 그 인스턴스에 this가 바인딩된다. 이 과정은 함수 몸체 코드 런타임 이전에 일어난다.

#### 2.인스턴스 초기화

&nbsp;코드가 한 줄씩 실행되어 this 바인딩되어 있는 인스턴스를 초기화한다.

#### 3.인스턴스 반환

&nbsp;모든 처리가 끝나면 완성된 인스턴스가 바인딩된 this가 암묵적으로 반환된다. 만약 this가 아닌 다른 객체가 return문에 있다면 그 객체가 반환된다. 하지만 return문에 있는 것이 원시 값일 경우는 바인딩된 this가 반환된다.

### 내부 메서드[[Call]]과 [[Construct]]

&nbsp;함수객체는 다른 객체들과 다르게 [[Call]]과 [[Construct]]같은 내부 메서그를 추가적으로 가지고 있다. 일반 함수가 호출되면 내부 메서드 [[Call]]이 호출되고, new 연산자와 함께 생성자 함수로서 호출되면 내부 메서드 [[Construct]]가 호출된다.

&nbsp;내부 메서드 [[Call]]을 갖는 함수 객체를 callable, [[Construct]]를 갖는 것은 constructor, 갖지 않는 다면 non-constructor라고 부른다. 즉, 함수는 반드시 callable이고 constructor이거나 non-constructor인 함수 객체로 나뉜다.

- constructor: 함수 선언문, 함수 표현식, 클래스(클래스도 함수임)
- non-constructor: 메서드(ES6 메서드 축약 표현), 화살표 함수

&nbsp;생성자 함수는 일반적으로 파스칼 케이스로 명명하여 일반 함수와 구별할 수 있도록 노력한다.

### new.target

&nbsp;파스칼 컨벤션을 사용하여도 실수는 언제나 발생할 수 있기 때문에 이를 방지하기 위해서 ES6에서는 new.target을 지원한다.

&nbsp;new.target은 this와 유사하게 constructor인 모든 함수 내부에서 암묵적으로 지역 변수와 같이 사용되며 메타 프로퍼티라고 부흔다.

&nbsp;함수 내부에서 new.target을 사용하면 new 연산자와 함꼐 생성자 함수로서 호출되었는 지 확인이 가능하다. 생성자 함수로 호출되면 new.target은 함수 자신을 가르킨다. 일반 함수로 호출될 시에는 undefined가 반환된다.
